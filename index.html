<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calling Card â€” Persona vibe</title>
  <meta name="theme-color" content="#e60012" />

  <!-- Ã¡udio -->
  <link rel="preload" href="assets/audio/calling-card-theme.mp3" as="audio" />

  <!-- fonte (diretÃ³rio informado) -->
  <link rel="preload" href="assets/fonts/persona_font4.ttf" as="font" type="font/ttf" crossorigin>

  <!-- fallback (HUD) -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">

  <style>
    /* ======== Fonte Persona ======== */
    @font-face{
      font-family: "P5Persona";
      src: url("assets/fonts/persona_font4.ttf") format("opentype");
      font-weight: 400 900;
      font-style: normal;
      font-display: swap;
    }

    :root{
      --p5-font: "P5Persona", Montserrat, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;

      /* >>> CONTROLES VISUAIS (fixos no â€œlook de PCâ€) <<< */
      --paper-pad: 72px;              /* espaÃ§o interno do papel */
      --measure: 62ch;                /* largura mÃ¡x. do texto corrido */
      --letter-w: 840px;              /* largura da carta/papel */

      /* >>> ÃREA DE SEGURANÃ‡A DO TEXTO (EVITA CORTAR NO TOPO/BASE) <<< */
      --safe-top: 72px;               /* afasta do topo inclinado */
      --safe-bottom: 92px;            /* afasta da base inclinada */
      --edge-gap: 24px;               /* espaÃ§o acima da faixa decorativa */

      /* >>> TEXTO DA CARTA <<< */
      --letter-size: 36px;            /* FIXO para manter visual do PC */
      --letter-lh: 1.7;
      --letter-p-gap: 100px;          /* espaÃ§amento sÃ³ entre parÃ¡grafos */
      --word-gap: 0.18em;             /* espaÃ§amento ENTRE PALAVRAS */

      /* >>> ALTURA/ANIMAÃ‡ÃƒO DA CARTA <<< */
      --letter-closed-h: 0px;         /* altura inicial (fechada) */
      --letter-speed: .9s;

      /* Selo (na aba) */
      --seal-size: 200px;
      --seal-top: 50%;

      /* DecoraÃ§Ã£o abaixo do triÃ¢ngulo (sobre o corpo) */
      --decor-w: 360px;
      --decor-top: 64%;

      --red:#e60012;
      --black:#0b0b0c;
      --white:#ffffff;
      --paper:#ffffff;
      --shadow: rgba(0,0,0,.50);
      --bg:url("assets/img/p5-bg.png");

      /* >>> AUTO-SCALE (preenchido via JS) <<< */
      --scale: 1;
    }

    *{box-sizing:border-box}
    html,body{
      height:100%; margin:0; background:#000; color:var(--white);
      font-family: Montserrat, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }

    /* ======== CENÃRIO ======== */
    .stage{
      min-height: 100dvh;
      position: relative;
      overflow: visible;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding: 24px 20px 96px;

      background:
        radial-gradient(1200px 800px at 10% -20%, rgba(0,0,0,.65), transparent 60%),
        radial-gradient(900px 900px at 110% 120%, rgba(0,0,0,.55), transparent 60%),
        var(--bg);
      background-size: cover, cover, cover;
      background-position: center, center, center;
      background-attachment: fixed;
      isolation:isolate;
    }

    /* ======== HUD ======== */
    .hud{
      position:fixed; inset:16px 16px auto auto; z-index:10; display:flex; gap:10px; align-items:center
    }
    .btn{
      appearance:none; border:0; cursor:pointer; user-select:none;
      padding:12px 14px; border-radius:12px; font-weight:900;
      text-transform:uppercase; letter-spacing:.08em;
      box-shadow: 0 10px 24px rgba(0,0,0,.35);
      transition: transform .15s ease, opacity .2s ease, background .2s ease;
    }
    .btn:active{ transform: translateY(1px) scale(.99) }
    .btn-music{ background:linear-gradient(90deg, var(--red), #ff3d4d); color:#fff }
    .btn-music[aria-pressed="false"]{ background:#15151d; color:#ddd; border:1px solid rgba(255,255,255,.25) }

    /* ======== AUTO-SCALE WRAPPER ======== */
    /* tudo dentro de #scaleInner Ã© escalado 0..1 para caber em telas menores */
    #autoScale{
      position: relative;
      width: 100%;
      display: flex;
      justify-content: center;
      /* a altura real desse contÃªiner Ã© setada pelo JS: height = scrollHeight * --scale */
      min-height: 0;
    }
    #scaleInner{
      width: 1024px;                 /* <<< BASE_W no JS: a â€œlargura de PCâ€ do seu design */
      transform-origin: top center;
      transform: scale(var(--scale));
      /* evita blur em alguns mobiles */
      -webkit-transform: translateZ(0) scale(var(--scale));
    }

    /* ======== ENVELOPE ======== */
    .wrap{ position:relative; z-index:2; width:var(--letter-w); margin: 0 auto; }

    .envelope{
      position:relative;
      width:var(--letter-w);
      aspect-ratio: 16/10;
      margin: 8px auto 0;
      transform: translateY(0);
      transition: transform .6s ease;
      cursor:pointer;
      filter: drop-shadow(0 30px 70px var(--shadow));
      perspective: 1200px;
      transform-style: preserve-3d;
    }

    .envelope .body{
      position:absolute; inset:0;
      border-radius: 18px;
      background: linear-gradient(#fff,#f7f7f7);
      border: 4px solid #000;
      z-index:1;
    }

    .flap-group{
      position:absolute; inset:0;
      transform-origin: top center;
      transition: transform .7s cubic-bezier(.2,.8,.2,1);
      z-index:3;
      transform-style: preserve-3d;
    }
    .envelope.open .flap-group{ transform: rotateX(150deg); }

    .flap-edge{
      position:absolute; inset: -2px;
      clip-path: polygon(0 0,100% 0,100% 56%,50% 86%,0 56%);
      background:#000; border-radius: 30px 30px 40px 40px;
      z-index:1;
    }
    .flap{
      position:absolute; inset:0;
      clip-path: polygon(0 0,100% 0,100% 56%,50% 86%,0 56%);
      background: linear-gradient(#fff,#f3f3f3);
      border-radius: 30px 30px 30px 30px;
      z-index:2;
    }

    /* SELO (imagem) dentro da flap-group */
    .seal{
      position:absolute;
      left:50%;
      top:var(--seal-top);
      transform: translate(-50%,-50%);
      width:var(--seal-size);
      height:var(--seal-size);
      padding:0;
      border:none;
      background:transparent;
      cursor:pointer;
      z-index:3;
    }
    .seal:focus-visible{ outline:0px solid #fff; outline-offset:4px }
    .seal > img{ width:100%; height:100%; display:block; object-fit:contain; border-radius:0; box-shadow:none; pointer-events:none; }

    /* DECORAÃ‡ÃƒO ABAIXO DO TRIÃ‚NGULO (sobre o corpo) */
    .decoration{
      position:absolute;
      left:50%;
      top: var(--top, var(--decor-top));
      transform: translate(-50%, 0) rotate(var(--rot, 0deg));
      width: var(--w, var(--decor-w));
      height:auto;
      z-index:2;
      pointer-events:none;
      image-rendering: -webkit-optimize-contrast;
    }

    .envelope.open{ transform: translateY(-8px) }

    /* ======== CARTA ======== */
    .letter{
      position:relative; width:var(--letter-w); margin:24px auto 0;
      max-height: var(--letter-closed-h);  /* comeÃ§a fechada */
      opacity: 0;
      overflow:hidden;                     /* impede vazar enquanto anima */
      transition:
        max-height var(--letter-speed) ease .1s,
        opacity .25s ease .05s;
      background: transparent;
      border-radius:16px;
      z-index:0;
    }
    .letter.show{ opacity: 1; }

    .letter.scroll.show{
      max-height: min(var(--_openH, 9999px), 82vh);
      overflow: auto;
      -webkit-overflow-scrolling: touch;
      background-clip: padding-box;
    }

    /* Papel e camadas internas */
    .paper{
      position:relative;
      margin: 10px;
      padding: var(--paper-pad);
      background: var(--paper);
      color:#111;
      border: 4px solid #000;
      box-shadow: 0 14px 26px rgba(0,0,0,.35);
      clip-path: polygon(2% 4%, 98% 0%, 100% 6%, 96% 12%, 100% 18%, 98% 24%, 100% 30%, 98% 36%, 100% 42%, 98% 48%, 100% 54%, 98% 60%, 100% 66%, 96% 72%, 100% 78%, 98% 84%, 100% 90%, 98% 96%, 2% 100%, 0% 94%, 4% 88%, 0% 82%, 4% 76%, 0% 70%, 4% 64%, 0% 58%, 4% 52%, 0% 46%, 4% 40%, 0% 34%, 4% 28%, 0% 22%, 4% 16%, 0% 10%);
      overflow:hidden;
    }

    .paper-decor--under{ pointer-events:none; position:absolute; inset:0; z-index:1; }

    .paper-content{
      position:relative; z-index:3;
      cursor: pointer;
      font-family: var(--p5-font);
      letter-spacing: .02em;

      overflow-wrap: anywhere;
      word-break: normal;
      hyphens: auto;

      max-width: var(--measure);
      width: 100%;
      margin-inline: auto;

      /* >>> ÃREA DE SEGURANÃ‡A <<< */
      padding-top: var(--safe-top);
      padding-bottom: var(--safe-bottom);
    }
    .paper-content p{
      font-size: var(--letter-size);
      line-height: var(--letter-lh);
      margin: 0 0 var(--letter-p-gap);
      word-spacing: var(--word-gap);
    }
    .paper-content p:last-child{ margin-bottom: 0; }

    .paper-decor--over{ pointer-events:none; position:absolute; inset:0; z-index:4; }

    .text-decor{
      position:absolute;
      left: var(--x, 50%); top: var(--y, 50%);
      transform: translate(-50%, -50%) rotate(var(--rot, 0deg));
      width: var(--w, 220px); height:auto;
      opacity: var(--op, .85);
      image-rendering: -webkit-optimize-contrast;
      mix-blend-mode: multiply;
    }

    .edge{
      width:100%; height:12px; margin: var(--edge-gap) auto 0;
      background:
        linear-gradient(90deg, #fff 0 8%, transparent 8% 12%, var(--red) 12% 24%, transparent 24% 28%,
                                #fff 28% 32%, transparent 32% 36%, #ff7280 36% 48%, transparent 48% 52%,
                                #fff 52% 56%, transparent 56% 60%, var(--red) 60% 76%, transparent 76% 80%,
                                #fff 80% 84%, transparent 84% 88%, #ff7280 88% 100%);
      filter: drop-shadow(0 -2px 8px rgba(230,0,18,.35));
      border-radius:10px;
    }

    /* ======== OVERLAY FORA DA CARTA ======== */
    .overlay-layer{
      position:absolute;
      inset:0;
      z-index:40;
      pointer-events:none; /* nÃ£o bloqueia cliques */
    }
    .overlay-decor{
      position:absolute;
      left: var(--x, 50%); top: var(--y, 50%);
      transform: translate(-50%, -50%) rotate(var(--rot, 0deg)) scale(.94);
      width: var(--w, 320px); height:auto;
      opacity:0;
      filter: saturate(1) contrast(1);
      image-rendering: -webkit-optimize-contrast;
      transition: opacity .45s ease, transform .55s cubic-bezier(.2,.8,.2,1);
      will-change: transform, opacity;
    }
    .overlay-active .overlay-decor{
      opacity: var(--op, .95);
      transform: translate(-50%, -50%) rotate(var(--rot, 0deg)) scale(1);
    }

    @media (prefers-reduced-motion: reduce){
      .envelope, .flap-group, .letter{ transition:none }
      .overlay-decor{ transition:none }
    }
  </style>
</head>
<body>
  <div class="stage">
    <div class="hud">
      <button id="musicToggle" class="btn btn-music" aria-pressed="true" aria-label="MÃºsica ligada">ğŸµ ON</button>
    </div>

    <!-- AUTO-SCALE: tudo dentro de #scaleInner Ã© â€œo seu PCâ€ -->
    <div id="autoScale">
      <div id="scaleInner">
        <div class="wrap" id="wrap">
          <!-- ENVELOPE -->
          <div class="envelope" id="envelope" aria-label="Envelope â€” clique no selo para abrir">
            <div class="body" aria-hidden="true"></div>

            <!-- GRUPO QUE SOBE: contorno + aba + SELO -->
            <div class="flap-group">
              <div class="flap-edge" aria-hidden="true"></div>
              <div class="flap" aria-hidden="true"></div>
              <button class="seal" id="sealBtn" aria-label="Abrir pelo selo">
                <img src="assets/img/wax-seal.png" alt="Selo">
              </button>
            </div>

            <!-- DECORAÃ‡ÃƒO (abaixo do triÃ¢ngulo, sobre o corpo do envelope) -->
            <!-- DecoraÃ§Ãµes (abaixo do triÃ¢ngulo, sobre o corpo do envelope) -->


<img
  class="decoration"
  src="assets/img/overlay-decor-4.png"
  alt="" aria-hidden="true"
  style="
    left: 50%;
    top: 30%;
    width: 260px;
    transform:
      translate(-50%, 0)
      rotate(0deg)
      scale(1.15);
    opacity: 1;
    z-index: 2;
  "
/>
<img
  class="decoration"
  src="assets/img/overlay-decor-1.png"
  alt="" aria-hidden="true"
  style="
    left: 68%;          /* % ou px â€” posiÃ§Ã£o X dentro do envelope */
    top: 10%;           /* % ou px â€” posiÃ§Ã£o Y dentro do envelope */
    width: 200px;       /* tamanho (altura ajusta automÃ¡tico) */
    transform:
      translate(-50%, 0)  /* mantÃ©m centrado no eixo X */
      rotate(-6deg)        /* rotaÃ§Ã£o */
      scale(1);            /* escala */
    opacity: 1;          /* 0 a 1 */
    z-index: 2;          /* 2 = sobre o corpo, abaixo da aba (3) */
  "
/>

<img
  class="decoration"
  src="assets/img/overlay-decor-6.png"
  alt="" aria-hidden="true"
  style="
    left: 50%;          /* % ou px â€” posiÃ§Ã£o X dentro do envelope */
    top: -25%;           /* % ou px â€” posiÃ§Ã£o Y dentro do envelope */
    width: 400px;       /* tamanho (altura ajusta automÃ¡tico) */
    transform:
      translate(-50%, 0)  /* mantÃ©m centrado no eixo X */
      rotate(0deg)        /* rotaÃ§Ã£o */
      scale(1);            /* escala */
    opacity: 1;          /* 0 a 1 */
    z-index: 2;          /* 2 = sobre o corpo, abaixo da aba (3) */
  "
/>

<img
  class="decoration"
  src="assets/img/overlay-decor-9.png"
  alt="" aria-hidden="true"
  style="
    left: 20%;          /* % ou px â€” posiÃ§Ã£o X dentro do envelope */
    top: 30%;           /* % ou px â€” posiÃ§Ã£o Y dentro do envelope */
    width: 200px;       /* tamanho (altura ajusta automÃ¡tico) */
    transform:
      translate(-50%, 0)  /* mantÃ©m centrado no eixo X */
      rotate(-6deg)        /* rotaÃ§Ã£o */
      scale(1);            /* escala */
    opacity: 1;          /* 0 a 1 */
    z-index: 2;          /* 2 = sobre o corpo, abaixo da aba (3) */
  "
/>

<img
  class="decoration"
  src="assets/img/overlay-decor-10.png"
  alt="" aria-hidden="true"
  style="
    left: 80%;          /* % ou px â€” posiÃ§Ã£o X dentro do envelope */
    top: 35%;           /* % ou px â€” posiÃ§Ã£o Y dentro do envelope */
    width: 200px;       /* tamanho (altura ajusta automÃ¡tico) */
    transform:
      translate(-50%, 0)  /* mantÃ©m centrado no eixo X */
      rotate(-6deg)        /* rotaÃ§Ã£o */
      scale(1);            /* escala */
    opacity: 1;          /* 0 a 1 */
    z-index: 2;          /* 2 = sobre o corpo, abaixo da aba (3) */
  "
/>
          </div>

          <!-- CARTA -->
          <section class="letter" id="letter" aria-live="polite">
            <div class="paper" id="paper">
              <div class="paper-decor--under"></div>

              <!-- CONTEÃšDO DO TEXTO (clicÃ¡vel para FECHAR) -->
              <div class="paper-content" id="paperContent" role="button" tabindex="0" title="Clique para fechar">
                <p>Â­Â­Â­ã…¤ã…¤</p>
                <p>Ontem, quando vocÃª me disse que estaria disposta a dar uma chance, meu coraÃ§Ã£o se aliviou como nÃ£o sentia hÃ¡ muito tempo. Eu sei que nÃ³s erramos, eu falhei contigo e vocÃª comigo, mas continuo acreditando que a nossa histÃ³ria nÃ£o precisa acabar assim.</p>
                <p>Eu nÃ£o estou aqui para te cobrar nada, nem para forÃ§ar sentimentos. SÃ³ quero viver essa chance que vocÃª mesma ofereceu: sair, conversar, rir, jogarâ€¦ e reencontrar aquele amor romÃ¢ntico que sempre foi sÃ³ nosso.</p>
                <p>Eu reconheÃ§o os erros que cometi, e sei a dor que te causei. Mas aprendi com isso e estou disposto a ser melhor, porque vocÃª merece essa versÃ£o de mim. Sobre o que aconteceu entre nÃ³s, nÃ£o quero mais viver preso Ã s mÃ¡goas. Eu te perdoo, e espero que com o tempo vocÃª tambÃ©m consiga me perdoar.</p>
                <p>Mas nÃ£o pense que isso Ã© apenas uma sÃºplica comum. Hoje, neste parque, o mesmo em que gravamos nossas iniciais dentro de um coraÃ§Ã£o naquela Ã¡rvore, sÃ­mbolo de quatro anos lado a lado, eu declaro minha verdadeira missÃ£o a partir de hoje: roubar de volta o seu coraÃ§Ã£o, revelar o seu tesouro e reconquistar o amor romÃ¢ntico que sempre foi sÃ³ nosso.</p>
                <p>Prepare-se, Lady Moon. Assim como os Phantom Thieves, eu nÃ£o falho em minha missÃ£o. Depois desse dia, diante dessa Ã¡rvore que ainda guarda nosso sÃ­mbolo, eu irei te abraÃ§arâ€¦ e, se me permitir, eu vou te beijar como nunca antes.</p>
                <p>E entÃ£o, diante de tudo que passamos e de tudo que ainda podemos viver, nÃ£o quero apenas roubar o seu coraÃ§Ã£oâ€¦ quero tambÃ©m que vocÃª volte a ser minha namorada, para juntos escrevermos o prÃ³ximo capÃ­tulo da nossa histÃ³ria.</p>
                <p>Posso roubar o seu coraÃ§Ã£oâ€¦ e voltar a ser o seu namorado?</p>
                <p class="sig">â€” Spike, o ladrÃ£o que nunca desistiu de vocÃª, e nunca irÃ¡.</p>

                <p>Â­Â­Â­ã…¤ã…¤</p>
                <p>Â­Â­Â­ã…¤ã…¤</p>
                <p>Â­Â­Â­ã…¤ã…¤</p>
                <div class="edge" aria-hidden="true"></div>
              </div>

              <div class="paper-decor--over"></div>
            </div>
          </section>

          <!-- OVERLAY POR CIMA DE TUDO DA CARTA -->
          <div class="overlay-layer" id="overlayLayer">
            <!-- EXISTENTE -->

            <!-- ADICIONE MAIS PNGs DUPLICANDO ESTES BLOCOS â†“â†“â†“ -->
            <img class="overlay-decor"
                 src="assets/img/overlay-decor-2.png"
                 alt="" aria-hidden="true"
                 style="--x: 78%; --y: 13%; --w: 320px; --rot: 0deg; --op: 1;" />

            <img class="overlay-decor"
                 src="assets/img/overlay-decor-3.png"
                 alt="" aria-hidden="true"
                 style="--x: 78%; --y: 15%; --w: 200px; --rot: -15deg; --op: 1;" />
          
            <img class="overlay-decor"
                 src="assets/img/overlay-decor-5.png"
                 alt="" aria-hidden="true"
                 style="--x: 85%; --y: 83%; --w: 150px; --rot: 0deg; --op: .98;" />

            <img class="overlay-decor"
                 src="assets/img/overlay-decor-7.png"
                 alt="" aria-hidden="true"
                 style="--x: 50%; --y: 92%; --w: 600px; --rot:-0deg; --op: .98;" />

            <img class="overlay-decor"
                 src="assets/img/overlay-decor-8.png"
                 alt="" aria-hidden="true"
                 style="--x: 50%; --y: 87%; --w: 100px; --rot:-0deg; --op: .98;" />
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ÃUDIO -->
  <audio id="bgm" src="assets/audio/calling-card-theme.mp3" loop preload="auto"></audio>

  <script>
    // ======= AUTO-SCALE =======
    // MantÃ©m o â€œlook de PCâ€ e reduz proporcionalmente em telas menores
    const BASE_W = 1024; // << se seu PC for 1280, mude aqui
    const autoScale   = document.getElementById('autoScale');
    const scaleInner  = document.getElementById('scaleInner');

    function applyScale(){
      const vw = Math.max(320, window.innerWidth);
      const s = Math.min(vw / BASE_W, 1);               // nunca aumenta alÃ©m do PC
      document.documentElement.style.setProperty('--scale', s);
      // ajusta a altura real do contÃªiner para o layout nÃ£o â€œcortarâ€
      const targetH = scaleInner.scrollHeight * s;
      autoScale.style.height = targetH + 'px';
    }
    // aplica em load/resize/orientaÃ§Ã£o
    addEventListener('load', applyScale, {once:true});
    addEventListener('resize', applyScale);
    addEventListener('orientationchange', ()=>setTimeout(applyScale, 60));

    // ======= LÃ“GICA EXISTENTE =======
    const envelope     = document.getElementById('envelope');
    const sealBtn      = document.getElementById('sealBtn');
    const letter       = document.getElementById('letter');
    const bgm          = document.getElementById('bgm');
    const toggle       = document.getElementById('musicToggle');
    const overlay      = document.getElementById('overlayLayer');
    const paperContent = document.getElementById('paperContent');
    const rootStyles   = getComputedStyle(document.documentElement);

    let hasInteracted = false;

    function startMusicOnce(){
      if(hasInteracted) return;
      hasInteracted = true;
      safePlay();
    }

    function safePlay(){
      bgm.loop = true;
      const p = bgm.play();
      if(p && typeof p.catch === 'function'){ p.catch(()=>{}); }
      toggle.setAttribute('aria-pressed','true');
      toggle.textContent = 'ğŸµ ON';
    }

    function fadeTo(targetVol=1, ms=350){
      const steps = 18, step = (targetVol - bgm.volume)/steps;
      let i=0;
      const id = setInterval(()=>{
        bgm.volume = Math.max(0, Math.min(1, bgm.volume + step));
        if(++i>=steps){ bgm.volume = targetVol; clearInterval(id); if(targetVol===0){ bgm.pause(); } }
      }, ms/steps);
    }

    function setOpenHeight(){
      const target = letter.scrollHeight;
      letter.style.setProperty('--_openH', target + 'px'); // Ãºtil p/ .letter.scroll.show
      letter.style.maxHeight = target + 'px';
      // re-calcula auto-scale porque a altura mudou
      applyScale();
    }

    function openLetter(){
      envelope.classList.add('open'); // abre o triÃ¢ngulo
      letter.classList.add('show');
      requestAnimationFrame(()=>{ setOpenHeight(); });

      const onEnd = (ev)=>{
        if(ev.target === letter && ev.propertyName === 'max-height'){
          overlay.classList.add('overlay-active');  // ativa TODOS os .overlay-decor
          letter.removeEventListener('transitionend', onEnd);
          applyScale(); // garante ajuste final
        }
      };
      letter.addEventListener('transitionend', onEnd);
    }

    function closeLetter(){
      overlay.classList.remove('overlay-active');
      envelope.classList.remove('open'); // fecha o triÃ¢ngulo

      const closed = rootStyles.getPropertyValue('--letter-closed-h').trim() || '0px';
      letter.style.maxHeight = closed;
      const onEnd = (ev)=>{
        if(ev.target === letter && ev.propertyName === 'max-height'){
          letter.classList.remove('show');
          letter.removeEventListener('transitionend', onEnd);
          applyScale();
        }
      };
      letter.addEventListener('transitionend', onEnd);
    }

    // Recalcula auto-scale apÃ³s imagens decorativas carregarem (altura muda)
    document.querySelectorAll('.overlay-decor,.decoration img').forEach(img=>{
      if(img.complete) return;
      img.addEventListener('load', applyScale);
    });

    // 1Âº clique em qualquer parte do envelope: sÃ³ inicia a mÃºsica
    envelope.addEventListener('click', startMusicOnce);

    // Abrir SOMENTE pelo selo
    sealBtn.addEventListener('click', (ev)=>{
      ev.stopPropagation();
      startMusicOnce();
      openLetter();
    });

    // Fechar: clicando na Ã¡rea do texto
    paperContent.addEventListener('click', closeLetter);

    // Teclado (acessibilidade): Enter/EspaÃ§o fecha
    paperContent.addEventListener('keydown', (e)=>{
      if(e.key === 'Enter' || e.key === ' '){
        e.preventDefault();
        closeLetter();
      }
    });

    // botÃ£o de mÃºsica
    toggle.addEventListener('click', ()=>{
      const on = toggle.getAttribute('aria-pressed') === 'true';
      if(on){
        toggle.setAttribute('aria-pressed','false');
        toggle.textContent = 'ğŸ”‡ OFF';
        fadeTo(0, 300);
      }else{
        toggle.setAttribute('aria-pressed','true');
        toggle.textContent = 'ğŸµ ON';
        if(bgm.paused){ bgm.volume = 0; safePlay(); }
        fadeTo(1, 300);
      }
    });

    // acessibilidade: Enter/EspaÃ§o no selo abre
    sealBtn.addEventListener('keydown', (e)=>{
      if(e.key === 'Enter' || e.key === ' '){
        e.preventDefault();
        startMusicOnce();
        openLetter();
      }
    });
  </script>
</body>
</html>
